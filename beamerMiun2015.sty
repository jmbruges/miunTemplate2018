% !TeX root = phd.tex
% !TeX spellcheck = en_GB
%: dedication
\ProvidesPackage{beamermiun2015}[2015/03/04 Beamer theme.]
%\newif\if@doSans
%\@doSansfalse
%\DeclareOption{noserifmath}{\@doSanstrue}
%\newif\if@doNoFlama
%\@doNoFlamafalse
%\DeclareOption{noflama}{\@doNoFlamatrue}
%\newif\if@doSans
%\@doSansfalse
%\DeclareOption{noserifmath}{\@doSanstrue}
\newif\if@doSectionPage
\@doSectionPagefalse
\DeclareOption{nosectionpages}{\@doSectionPagetrue}
\ProcessOptions

\RequirePackage{xifthen, tikz}

%\define@choicekey*{fam}{}


\newlength\lpg@logoht
\newlength\lpg@logomg

\newlength\lpg@lineoff
\newlength\lpg@lineht
\newlength\lpg@linewd
\newlength\lpg@linepos

\newlength\lpg@rulethickness


\usebeamerfont{normal text}
\setbox0=\hbox{\strut}
\newlength\strutht \strutht\ht0
\newlength\strutdp \strutdp\dp0

%\def\numex(#1){\numexpr#1\relax}
\def\dim(#1){\dimexpr#1\relax}

%---------------------------------------------------------------------
% colors
%---------------------------------------------------------------------

\definecolor{miunyellow}{cmyk}{0,0.25,0.99,0}
\definecolor{miunblue}{cmyk}{0.86,0.49,0,0}


% all colours are allowed for research

% grays
\definecolor{miunlightgray}{cmyk}{0.18,0.16,0.2,0.01}
\definecolor{miunmediumgray}{cmyk}{0.32,0.31,0.35, 0.1}
\definecolor{miundarkgray}{cmyk}{0.47,0.47,0.51,0.38}
% extra colours

\definecolor{miunredorange}{cmyk}{0.1,0.78,1,0}
\definecolor{miungreen}{cmyk}{0.73,0,1,0}
\definecolor{miunorange}{cmyk}{0,0.44,0.94,0}
\definecolor{miuntorquoise}{cmyk}{0.74,0, 0.19,0}

%blue colour scheme

%other colours
\definecolor{darkorange}{RGB}{188,90,18}
\definecolor{bibstruct}{rgb}{.95,.95,.85}
    
    
%---------------------------------------------------------------------
\setbeamercolor{title}{fg=white, bg=black}
\setbeamercolor{date}{fg=white,bg=black}
\setbeamercolor{author}{fg=white,bg=black}
\setbeamercolor{institute}{fg=white, bg=black}

\setbeamercolor{structure}{fg=miunblue}
\setbeamercolor{normal text}{fg=black, bg=white}
\setbeamercolor{alerted text}{fg=miunredorange, bg=miunredorange!20}
\setbeamercolor{example text}{fg=miungreen!80!black, bg=miungreen!20}

\setbeamercolor{section in head/foot}{fg=gray!50!black}
\setbeamercolor{subsection in head/foot}{parent=section in head/foot}
\setbeamercolor{item projected}{bg=structure}

\setbeamercolor{block title}{fg=structure, bg=structure!20}
\setbeamercolor{block title alerted}{parent=alerted text}
\setbeamercolor{block title example}{parent=example text}
\setbeamercolor{block body}{parent=block title, fg=normal text.fg}
\setbeamercolor{block body alerted}{parent=block title alerted, fg=normal text.fg}
\setbeamercolor{block body example}{parent=block title example, fg=normal text.fg}

\setbeamercolor{lower separation line head}{parent=structure}
\setbeamercolor{upper separation line foot}{use=black!50, bg=black!50}
\setbeamercolor{bibliography structure}{fg=normal text.fg, bg=bibstruct}
\setbeamertemplate{footnote}{%
    \tiny%
    \parindent 1em\noindent%
    \raggedright
    \hbox to 1.8em{\hfil\insertfootnotemark}\insertfootnotetext\par%
}%
\setlength\footnotesep{0pt}
%---------------------------------------------------------------------
% colors
\setbeamerfont{subtitle}{series=\mdseries}

\setbeamerfont{structure}{series=\bfseries}
\setbeamerfont{author}{series=\bfseries,size=\normalsize}
\setbeamerfont{date}{size=\scriptsize}
\setbeamerfont{normal text}{size=\small}% not used, so it is useless
\setbeamerfont{frametitle}{size=\Large}
\setbeamerfont{framesubtitle}{parent=frametitle, size=\small, shape=\itshape}
\setbeamerfont{title in head/foot}{shape=\slshape,size=\tiny,series=\mdseries}
\setbeamerfont{author in head/foot}{size=\Tiny}
\setbeamerfont{section in head/foot}{size=\Tiny,series=\bfseries}
\setbeamerfont{subsection in head/foot}{size=\Tiny,series=\bfseries}
\setbeamerfont{block title}{size=\normalsize}
\setbeamerfont{bibliography entry author}{series=\bfseries,size=\footnotesize}
\setbeamerfont{bibliography entry title}{series=\mdseries}



%---------------------------------------------------------------------
% custom commands
%---------------------------------------------------------------------
%\newcommand{\rightTextArrow}{→}
\newcommand{\quoted}[1]{›#1‹}
\newcommand{\doublequoted}[1]{»#1«}
\newcommand*{\inputtikz}[2]{%
    \resizebox*{#1\textwidth}{!}{%
        \input{figures/#2}}}
%---------------------------------------------------------------------
% Itemize
%---------------------------------------------------------------------
%\setbeamertemplate{itemize item}{\rightTextArrow}
%\setbeamertemplate{itemize subitem}{\rightTextArrow}
%\setbeamertemplate{itemize subsubitem}{\rightTextArrow}

\setlength{\parskip}{0.5em}

%---------------------------------------------------------------------
% Titlepage
%---------------------------------------------------------------------
\def\barsize {0.66}
% Titlepage structure
\def\maketitle{\ifbeamer@inframe\titlepage\else\frame[plain]{\titlepage}\fi}
\def\titlepage{\usebeamertemplate{title page}}
\setbeamertemplate{title page}
{%
    \begin{tikzpicture}[remember picture,overlay]
        \coordinate [above=\paperheight*\barsize*0.5] (midpoint) at (current page.south);
        \node [name=colourbar,
            anchor=base,
            fill=miunblue,
            text = white,
            minimum width=\paperwidth,
            minimum height=\barsize*\paperheight] at (midpoint) {};
    \end{tikzpicture}
    \vspace*{2em}
    \hfill\includegraphics[width=25mm]{MIUN_logotyp.pdf}\par%
    \vspace*{1cm}
    \ifx\inserttitle\@empty%
    \else%
    {\usebeamerfont{title}\usebeamercolor[fg]{title}\inserttitle\par}%
    \fi%
%        \vspace{0.5em}
    \ifx\insertsubtitle %\@empty
    {\usebeamerfont{subtitle}\colorbox{miunblue}{M\par}}%
    \else%
    {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
    \fi%
    \vspace{0.5cm}
    \ifx\insertdate\@empty%
    \else%
    {\usebeamerfont{date}\usebeamercolor[fg]{date}\insertdate\par}%
    \fi% 
    \vspace{0.5cm}
    \ifx\insertauthor\@empty%
    \else%
    {\usebeamerfont{author}\usebeamercolor[fg]{author}\insertauthor\par}%
    \fi%
    \ifx\insertinstitut\@empty%
    \else%
%        \vspace*{3mm}
    {\usebeamerfont{institute}\usebeamercolor[fg]{institute}\insertinstitute\par}%
    \fi% 
%   \vfill
}

%<< ~~[· frametitle   ·]~~ >>

\setbeamertemplate{frametitle}{%
  \vskip 1ex
  \begin{beamercolorbox}
    [wd=\lpg@linewd, ht=\strutht, dp=\strutdp] {frametitle}
    \usebeamerfont{frametitle}\strut\insertframetitle
  \end{beamercolorbox}
  \ifx\insertframesubtitle\@empty
  \else
    \vskip-.8ex
    \begin{beamercolorbox}
      [wd=\lpg@linewd, ht=\strutht, dp=\strutdp] {framesubtitle}
      \usebeamerfont{framesubtitle}\strut\insertframesubtitle
    \end{beamercolorbox}
  \fi}



%>>
%<< ~~[· footline     ·]~~ >>

\setbeamertemplate{footline}{%
  \ifnum\insertframenumber=1
  \else
    \begin{beamercolorbox}
      [ht=\lpg@lineht, colsep*=-\lpg@lineoff]
      {upper separation line foot}
    \end{beamercolorbox}
    \begin{beamercolorbox}
      [wd=\lpg@linewd, ht=\dim(\lpg@logoht+\lpg@logomg),
       leftskip=\lpg@lineoff, rightskip=\lpg@lineoff] {footline}
      \vskip1ex\strut
      \hbox to \lpg@linewd{%
%        \rlap{\usebeamerfont{author in head/foot}\insertshortauthor}
        \rlap{Mittuniversitetet}
        \hfil\hbox{%
          \usebeamerfont{title in head/foot}\insertshorttitle}\hfil
        \llap{\pgfbox[right,base]{%
%            \ifx\lpg@logo\@empty\else\pgfuseimage{logo}\fi}}}
         \insertframenumber{} / \inserttotalframenumber}}}
      \vskip.4ex
  \end{beamercolorbox}
  \fi}



%---------------------------------------------------------------------
% Blocks
%---------------------------------------------------------------------
\newenvironment<>{tightblock}[1]{%
    \begin{actionenv}#2%
        \def\insertblocktitle{\leftskip=2pt\rightskip=2pt #1}%
        \par%
        \usebeamertemplate{block begin}\leftskip=1pt\rightskip=2pt}
    {\par\vspace{2pt}\usebeamertemplate{block end}
    \end{actionenv}}
    
\newenvironment<>{talertblock}[1]{%
    \begin{actionenv}#2%
        \def\insertblocktitle{\leftskip=2pt\rightskip=2pt #1}%
        \par%
        \usebeamertemplate{block alerted begin}\leftskip=1pt\rightskip=2pt}
    {\par\vspace{2pt}\usebeamertemplate{block alerted end}
    \end{actionenv}}
    
%\newenvironment<>{tightblock}[1][]{%
%  \setbeamertemplate{block begin}{%
%  \setbeamercolor{item}{parent=block body}
%  \par\vskip\medskipamount%
%  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex]{block title}
%      \usebeamerfont*{block title}\insertblocktitle%
%    \end{beamercolorbox}%
%    {\parskip0pt\par}%
%    {\nointerlineskip\vskip-0.5pt}%
%    \usebeamerfont{block body}%
%    \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.1ex,rightskip=0.1ex,vmode]{block body}%
%    }
%    \setbeamertemplate{block end}  
%    {\end{beamercolorbox}\vskip\smallskipamount}
%}

\setbeamertemplate{block begin}
{
    \setbeamercolor{item}{parent=block body}
    \par\vskip\medskipamount%
    \begin{beamercolorbox}[sep=.9ex,dp=0.6ex,leftskip=0.1ex,rightskip=0.1ex]{block title}
        \usebeamerfont*{block title}\insertblocktitle\hfill\ %
    \end{beamercolorbox}%
    {\parskip0pt\par}%
    {\nointerlineskip\vskip-0.5pt}%
    \usebeamerfont{block body}%
    \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex,vmode]{block body}%
    }
    \setbeamertemplate{block end}  
    {\end{beamercolorbox}\vskip\smallskipamount}

\setbeamertemplate{block alerted begin}
{
    \setbeamercolor{item}{parent=block body alerted}
    \par\vskip\medskipamount%
    \begin{beamercolorbox}[sep=.9ex,dp=0.6ex,leftskip=0.1ex,rightskip=0.1ex]{block title alerted}
        \usebeamerfont*{block title alerted}\insertblocktitle%
    \end{beamercolorbox}%
    {\parskip0pt\par}%
    {\nointerlineskip\vskip-0.5pt}%
    \usebeamerfont{block body alerted}%
    \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex,vmode]{block body alerted}%
    }
    \setbeamertemplate{block alerted end}
    {\end{beamercolorbox}\vskip\smallskipamount}

\setbeamertemplate{block example begin}
{
    \par\vskip\medskipamount%
    \begin{beamercolorbox}[sep=.25ex,dp=0.6ex,leftskip=0.1ex,rightskip=0.1ex]{block title example}
        \usebeamerfont*{block title example}\insertblocktitle\hfill\ %
    \end{beamercolorbox}%
    {\parskip0pt\par}%
    {\nointerlineskip\vskip-0.5pt}%
    \usebeamerfont{block body example}%
    \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex,vmode]{block body example}%
    }
    \setbeamertemplate{block example end}
    {\end{beamercolorbox}\vskip\smallskipamount}

%%>>
%%<< ~~[· blocks       ·]~~ >>
%
%\newcommand\defblock[1][]{%
%  \edef\doit{%
%    \noexpand\dodefblock
%    {block \ifx#1\@empty\else#1\space\fi begin}
%    {block \ifx#1\@empty\else#1\space\fi end}
%    {block title\ifx#1\@empty\else\space#1\fi}
%    {block body\ifx#1\@empty\else\space#1\fi}}
%  \doit}
%
%\def\dodefblock#1#2#3#4{%
%  \setbeamertemplate{#1}{%
%    \setbox\beamer@tempbox=
%    \hbox to 0.95\textwidth\bgroup
%    \vbox\bgroup\raggedright
%    \begin{minipage}{0.95\textwidth}
%      \ifx\insertblocktitle\@empty\else
%        {\usebeamerfont{#3}\usebeamercolor[fg]{#3}\insertblocktitle}
%        \vskip-2ex
%        \begin{tikzpicture}
%          \usebeamercolor{#3}
%          \path [draw=fg!50!bg, line width=\lpg@rulethickness]
%            (0 ,0) -- (\textwidth,0);
%        \end{tikzpicture}\par\fi
%      \usebeamerfont{#4}\usebeamercolor[fg]{#4}}
%  \setbeamertemplate{#2}{%
%    \end{minipage}\egroup\egroup% close \vbox then \hbox
%    \usebeamercolor{#3}
%    \begin{center}
%      \begin{tikzpicture}
%        \node [draw=fg!50!bg, fill=bg, % rounded corners=2pt,
%               line width=\lpg@rulethickness] {\box\beamer@tempbox};
%      \end{tikzpicture}
%    \end{center}}}

%>>

\useinnertheme{default}

%\defblock
%\defblock[example]
%\defblock[alerted]

\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{section in head/foot shaded}[default][15]
\setbeamertemplate{subsection in head/foot shaded}[default][75]

%<< ~~[· macros       ·]~~ >>

\let\lpg@logo\@empty
\def\lpglogo#1{%
  \def\lpg@logo{#1}
  \pgfdeclareimage[height=\lpg@logoht]{logo}{#1}}
\def\lpglogoheight{\setlength\lpg@logoht}
\def\lpglogomargin{\setlength\lpg@logomg}

\def\lpgrulethickness{\setlength\lpg@rulethickness}

\def\lpglineoffset{\setlength\lpg@lineoff}
\def\lpglineheight{\setlength\lpg@lineht}
\def\lpglinewidth{\setlength\lpg@linewd}

%\let\bibliographyorig\bibliography
%\def\bibliography#1{%
%  \begin{center}
%    \begin{tikzpicture}
%      \usebeamercolor{bibliography structure}
%      \node [draw=fg!30!bg, fill=bg, rounded corners=2pt]
%        {\parbox{0.95\textwidth}{\bibliographyorig{#1}\vskip2mm}};
%    \end{tikzpicture}
%  \end{center}}
%
%\renewcommand{\emph}[1]{\textcolor{structure.fg}{\em #1}}



%>>

%---------------------------------------------------------------------
% Sectionpages
%---------------------------------------------------------------------


\if@doSectionPage\@empty
\else
% Insert frame with section title at every section start
\AtBeginSection[]
{
    \begingroup
    \setbeamercolor{background canvas}{bg=miunblue}
    \begin{frame}[plain]
        \centering
        \vfill\usebeamerfont{section title}\textcolor{white}{\insertsectionhead}\vfill
    \end{frame}
    \endgroup
}
\fi


\lpgrulethickness{.6pt}
\lpglineheight\lpg@rulethickness

\lpglineoffset{1.em}
\lpglinewidth{\dim(\paperwidth-2\lpg@lineoff)}

\lpglogoheight{2mm}
\lpglogomargin{2mm}
